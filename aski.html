<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ASKI — Dashboard Arsiparis DAP</title>
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <header class="navbar">
    <div class="nav-inner">
      <div class="nav-top">
        <div class="brand">ASKI — Dashboard Arsiparis DAP</div>
        <nav class="menu">
          <a href="index.html">HOME</a>
          <a href="pkpkt.html">PKPKT</a>
          <a href="aski.html">ASKI</a>
          <a href="monev.html">MONEV</a>
          <a href="arsiparis.html">ARSIPARIS</a>
        </nav>
        <div class="auth">
          <button id="loginBtnTop" class="btn-login">Login Admin</button>
        </div>
      </div>
      <div class="years">
        <button class="year">2025</button>
        <button class="year">2025</button>
        <button class="year">2025</button>
        <button class="year">2026</button>
        <button class="year">2026</button>
        <button class="year">2026</button>
      </div>
    </div>
  </header>

  <main class="container">
    <h2>ASKI — Data Arsiparis & Eviden</h2>
    <section>
      <h3>Pencarian Data Base Arsiparis</h3>
      <div class="search-row">
        <input type="text" id="searchInputPage" placeholder="Masukkan nama arsiparis...">
        <button id="searchBtnPage">Cari</button>
      </div>
      <div id="searchResultsPage" class="results"></div>
    </section>

    <section style="margin-top:18px">
      <h3>Input Eviden (hanya admin)</h3>
      <div id="evidenPanelPage"></div>
    </section>
  </main>

  <script>
    // Reuse app data renderer where possible by loading JSON and rendering minimal lists
    fetch('data/arsiparis.json').then(r=>r.json()).then(d=>{
      // render search results
      document.getElementById('searchBtnPage').addEventListener('click', ()=>{
        const q = document.getElementById('searchInputPage').value.trim().toLowerCase();
        const target = document.getElementById('searchResultsPage');
        if(!q){ target.innerText='Masukkan nama untuk mencari.'; return; }
        const found = d.arsiparis.filter(a=>a.name.toLowerCase().includes(q));
        if(found.length===0){ target.innerHTML = `<div>Tidak ditemukan hasil untuk "${q}"</div>`; return; }
        let html=''; found.forEach(a=>{ html+=`<div class="card"><strong>${a.name}</strong> — ${a.unit} / ${a.kecamatan}<br>Tahun: ${a.tahun}</div><hr>`; }); target.innerHTML = html;
      });

      // show a simplified eviden uploader if admin: we will reuse localStorage-based eviden from main app
      const panel = document.getElementById('evidenPanelPage');
      panel.innerHTML = `
        <div class="eviden-panel">
          <label>Kecamatan</label><input id="e_kec" placeholder="kecamatan">
          <label>Unit</label><input id="e_unit" placeholder="unit">
          <label>Tahun</label><input id="e_th" type="number" value="2025">
          <label>Foto</label><input id="e_file" type="file" accept="image/*">
          <div id="e_preview"></div>
          <div style="margin-top:8px"><button id="e_save" class="btn-primary">Simpan Eviden</button></div>
          <div id="e_list" style="margin-top:10px"></div>
        </div>`;

      // simple wiring (reuse the same localStorage key 'dap_eviden')
      const file = document.getElementById('e_file'); const preview=document.getElementById('e_preview');
      file.addEventListener('change', (ev)=>{ const f=ev.target.files[0]; if(!f) { preview.innerHTML=''; return; } const r=new FileReader(); r.onload=()=> preview.innerHTML=`<img src="${r.result}" style="max-width:200px">`; r.readAsDataURL(f); });
      document.getElementById('e_save').addEventListener('click', ()=>{
        if(!localStorage.getItem('dap_admin')){ alert('Hanya admin dapat menyimpan eviden.'); return; }
        const kec=document.getElementById('e_kec').value.trim(); const unit=document.getElementById('e_unit').value.trim(); const th=document.getElementById('e_th').value; const f=document.getElementById('e_file').files[0];
        if(!kec||!unit||!th||!f){ alert('Lengkapi form dan pilih foto.'); return; }
        const rdr=new FileReader(); rdr.onload=()=>{
          const arr= localStorage.getItem('dap_eviden')? JSON.parse(localStorage.getItem('dap_eviden')):[];
          arr.push({id:Date.now(), kecamatan:kec, unit:unit, tahun:th, note:'(dimasukkan via ASKI page)', dataURL:rdr.result});
          localStorage.setItem('dap_eviden', JSON.stringify(arr));
          alert('Eviden tersimpan.'); renderList();
        }; rdr.readAsDataURL(f);
      });
      function renderList(){ const arr=localStorage.getItem('dap_eviden')? JSON.parse(localStorage.getItem('dap_eviden')):[]; const el=document.getElementById('e_list'); if(!arr.length){ el.innerHTML='<div>Tidak ada eviden.</div>'; return; } el.innerHTML=''; arr.slice().reverse().forEach(e=>{ const d=document.createElement('div'); d.className='eviden-item'; d.innerHTML=`<img src="${e.dataURL}" style="width:120px;height:80px;object-fit:cover"><div class="eviden-meta"><strong>${e.unit}</strong><br>${e.kecamatan} — ${e.tahun}</div>`; el.appendChild(d); }); }
      renderList();

    }).catch(()=>{ document.getElementById('searchResultsPage').innerText='Gagal memuat data.' });

    // wire top login button to open existing modal in index (if user navigated from index) — otherwise do nothing
    document.getElementById('loginBtnTop').addEventListener('click', ()=>{ alert('Gunakan Login Admin dari halaman utama atau implementasi server-side auth.'); });
  </script>
</body>
</html>